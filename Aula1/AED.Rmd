---
title: "Pós-graduação em Ciências Veterinárias (IV/UFRRJ)"
subtitle: "Análise Exploratória de Dados (AED) - Uma Revisão"
author: |
  | Adriana Andrade
  |
  | Wagner Tassinari 
  |
date: "2021"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
---

```{r, echo=FALSE}
htmltools::img(src = knitr::image_uri("figure/logo_ufrrj.jpg"), 
               alt = 'logo', 
               style = 'position:absolute; top:20%; right:0%; padding:10px; height:100px;out.width=80%')
```


```{r setup, include=FALSE}
library(knitr)

## Global options
options(max.print="75")
knitr::opts_chunk$set(echo=FALSE,
               cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE,
               cache.lazy=FALSE)
knitr::opts_knit$set(width=75)

```


```{r klippy}
# Insert copy to clipboard buttons in HTML documents
# remotes::install_github("rlesur/klippy")
klippy::klippy(
  lang = c("r", "markdown"),
  all_precode = FALSE,
  position = c("top", "right"),
  color = "navyblue",
  tooltip_message = "copiar código",
  tooltip_success = "copiado!"
)

```


```{css echo=FALSE}
/* Define a margin before h2 element */
h2  {
  margin-top: 4em;
}

/* Define a margin after every first p elements */
p:first-of-type {
  margin-bottom: 2em;
}
``` 


```{r}
## Color Format
colFmt <- function(x,color) {
  
  outputFormat <- knitr::opts_knit$get("rmarkdown.pandoc.to")
  
  if(outputFormat == 'latex') {
    ret <- paste("\\textcolor{",color,"}{",x,"}",sep="")
  } else if(outputFormat == 'html') {
    ret <- paste("<font color='",color,"'>",x,"</font>",sep="")
  } else {
    ret <- x
  }

  return(ret)
}

```

---

# Para que serve a AED ?

* Em estatística, a análise exploratória de dados (AED) é uma abordagem à análise de conjuntos de dados de modo a resumir suas características principais, frequentemente com métodos visuais. 

- Um modelo estatístico pode ou não ser usado, mas inicialmente a AED tem como objetivo observar o que os dados podem nos dizer além da modelagem formal ou do processo de testes de hipóteses. 

- As técnicas da AED nos ajudam a extrair informações relevantes de um conjunto de dados.

[Fonte: Wikipédia](https://pt.wikipedia.org/wiki/An%C3%A1lise_explorat%C3%B3ria_de_dados)

---

#  Etapas do AED 

### 1. Conhecer a base de dados

* Tipos de variáveis
* Completude dos dados (preenchimento das variáveis - *missings data*)*
* Outliers


### 2. Utilização de medidas de estatística descritiva
    
* Medidas de frequência (vars. categóricas)
* Medidas de têndencia central e dispersão (vars. quantitativas)
* Medidas de associação (Análises Bivariadas)
* Utilização de métodos visuais (gráficos)
    
    
---

# Prática

- Base de dados: daisy.xls

- Esta base trata-se de dados de um estudo tipo coorte de um rebanho bovino, a respeito das condições de saúde de um rebanho leiteiro no período pós-parto, juntamente com medidas de desempenho reprodutivo. O objetivo é avaliar o efeito de várias doenças no desempenho reprodutivo.

- Dicionário de variáveis:

|  Variável |                              Descrição                             | Codificação |
|:---------:|:------------------------------------------------------------------:|-------------|
| **farmnum**   | id propriedade                                                     |             |
| **cownum**    | id animal                                                          |             |
| **firstest**  | dias do parto ao primeiro estro observado                          | dias        |
| **firstbrb**  | dias desde o parto até a primeira criação (40 dias período mínimo) | dias        |
| **calvcon**   | dias desde o parto até a concepção (gravidez)                      | dias        |
| **age**       | idade em anos                                                      | anos        |
| **culled**    | desenvolveu folículos ovarianos císticos ?                         | 0/1         |
| **dayscull**  | dias desde pós-parto até remoção da placenta                       | dias        |
| **endomet**   | teve endometrite ?                                                 | 0/1         |
| **mastitis**  | teve mastite ?                                                     | 0/1         |
| **metritis**  | teve metrite ?                                                     | 0/1         |
| **milkfever** | teve febre do leite ?                                              | 0/1         |
| **ovar**      | teve doença cística do ovário ?                                    | 0/1         |
| **pyomet**    | teve piometrite ?                                                  | 0/1         |
| **retpla**    | as membranas fetais foram retidas por 48 horas ?                   | 0/1         |



- Vamos supor que estamos interessados em estudar a relação entre a metrite em relação a algumas variáveis explicativas

- Neste exemplo prático, vamos mostrar algumas técnicas de EAD para dados quantitativos e categóricos usando apenas algumas variáveis da base de dados daisy.

- Serão escolhidas as variáveis: 
    
    - **Variável de desfecho:** metrite
    
    - **Variáveis de explicativas:** calvcon, age, culled, ovar, retpla

---

# Preparando o banco de dados


- Abra o banco de dados:

```{r, echo=T}
library(readxl)
daisy <- read_excel("~/Google Drive/UFRRJ/Modelos Regressão 2021/Bancos/daisy.xls")

```


Ou siga as seguintes etapas no RStudio: `r colFmt(" *Environment --> Import Dataset --> From Excel...*", "orange")`


* Selecine as variáveis para compor o banco que será trabalhado

   - `r colFmt(" *cownum* - Identificador do animal", "darkviolet")`
   - `r colFmt(" *metritis* - Metrite", "darkviolet")`
   - `r colFmt(" *calvcon* - Dias desde o parto até a concepção ", "darkviolet")`
   - `r colFmt(" *age* - Idade", "darkviolet")`
   - `r colFmt(" *culled* - Folículos ovarianos císticos ", "darkviolet")`
   - `r colFmt(" *ovar* - Doença cística do ovário ", "darkviolet")`
   - `r colFmt(" *retpla* - Membranas fetais foram retidas", "darkviolet")`
  


```{r, echo=T}
myvars <- c("cownum", "metritis", "calvcon", "age", "culled", "ovar", "retpla")
banco <- daisy[myvars]
```


---

# Estruturando o banco de dados

```{r, echo = T}

# Colocando os labels nas variáveis categóricas

# Metrite
banco$metritis <- factor(banco$metritis, labels = c("Nao", "Sim"))
banco$metritis <- relevel(banco$metritis, "Sim")

# Folículos ovarianos císticos
banco$culled <- factor(banco$culled, labels = c("Nao", "Sim"))
banco$culled <- relevel(banco$culled, "Sim")

# Doença cistica do ovario
banco$ovar <- factor(banco$ovar, labels = c("Nao", "Sim"))
banco$ovar <- relevel(banco$ovar, "Sim")

# Membranas fetais foram retidas por 48 horas
banco$retpla <- factor(banco$retpla, labels = c("Nao", "Sim"))
banco$retpla <- relevel(banco$retpla, "Sim")

```

---

# Pacote *DataExplorer*


```{r, echo = T, out.width='80%'}
library(DataExplorer)
plot_intro(banco)
```

[* Introduction to DataExplorer](https://cran.r-project.org/web/packages/DataExplorer/vignettes/dataexplorer-intro.html#replace-missing-values)

---

# Verificando a distribuição das variáveis categóricas


```{r, echo = T, results='markdown'}

# Metrite
table(banco$metritis) # Freq simples
prop.table(table(banco$metritis)) # Freq relativa

# Folículos ovarianos císticos
table(banco$culled) # Freq simples
prop.table(table(banco$culled)) # Freq relativa

# Doença cística do ovário
table(banco$ovar) # Freq simples
prop.table(table(banco$ovar)) # Freq relativa

#  Membranas fetais foram retidas
table(banco$retpla) # Freq simples
prop.table(table(banco$retpla)) # Freq relativa

```

---

# Verificanco a distribuição das variáveis categóricas graficamente


```{r, echo = T, out.width='90%'}

par(mfrow=c(2,2))
barplot(prop.table(table(banco$metritis)), ylab = "Freq. Relativa", xlab = "Metrite")
barplot(prop.table(table(banco$culled)), ylab = "Freq. Relativa", xlab = "Folículos ovarianos císticos") 
barplot(prop.table(table(banco$ovar)), ylab = "Freq. Relativa", xlab = "Doença cística do ovário")
barplot(prop.table(table(banco$retpla)), ylab = "Freq. Relativa", xlab = "Membranas fetais foram retidas")
```

---

# Verificanco a distribuição das variáveis quantitativas


```{r, echo = T, results='markdown'}
# Variavel idade
summary(banco$age)

# Variavel calvcon - Dias desde o parto até a concepção
summary(banco$calvcon)

```

---

# Verificanco a distribuição das variáveis quantitativas graficamente


```{r, echo = T, eval =T, out.width='90%'}
# Idade
par(mfrow=c(2,1))
hist(banco$age, xlab = "Idade", 
                  main="Histograma da Idade")
boxplot(banco$age, xlab = "Idade", 
                main="Boxplot da Idade", horizontal=TRUE)

```



```{r, echo = T, eval =T, out.width='90%'}
# Dias desde o parto até a concepção
par(mfrow=c(2,1))
hist(banco$calvcon, xlab = "calvcon", 
                  main="Dias desde o parto até a concepção")
boxplot(banco$calvcon, xlab = "calvcon", 
                main="Boxplot da calvcon", horizontal=TRUE)

```


---

# Categorizando a variável idade 

```{r, echo = T, eval =T, out.width='90%'}

# Idade categorica
banco$faixa_eta <- cut((banco$age), breaks = c(0, 2, 5, Inf), labels = c("Jovem", 
    "Adulto", "Velho"))
table(banco$faixa_eta)
```

---

# Distribuião da metrite segundo a faixa etária


* Utilizando o pacote *gmodels* [link](https://www.rdocumentation.org/packages/gmodels)

```{r, echo = T, eval =F, out.width='70%', results='markdown'}
library(gmodels)

CrossTable(banco$faixa_eta, banco$metritis, digits=2, prop.r=FALSE, 
           prop.c=TRUE, prop.t=FALSE, prop.chisq=FALSE, 
           chisq = FALSE, fisher=FALSE, mcnemar=FALSE)

```

````{r, echo = T, eval =F, out.width='70%', results='markdown'}
# Stacked Bar Plot 

tabela <- table(banco$faixa_eta, banco$metritis)

barplot(prop.table(tabela), main="Metrite segundo a faixa etária",
  xlab="Idade", col=c("blue", "orange", "red"),
  legend = rownames(tabela), args.legend = list(x = 'topleft'))

```

# Distribuião da metrite segundo a presença de folículos ovarianos císticos


```{r, echo = F, out.width='70%', results='markdown'}
library(gmodels)

CrossTable(banco$culled, banco$metritis, digits=2, prop.r=FALSE, 
           prop.c=TRUE, prop.t=FALSE, prop.chisq=FALSE, 
           chisq = FALSE, fisher=FALSE, mcnemar=FALSE)

```

````{r, echo = T, eval =F, out.width='70%', results='markdown'}
# Stacked Bar Plot 

tabela <- table(banco$culled, banco$metritis)

barplot(prop.table(tabela), main="Metrite segundo a presença de folículos ovarianos císticos",
  xlab="Presença de folículos ovarianos císticos", col=c("blue", "red"),
  legend = rownames(tabela), args.legend = list(x = 'topleft'))

```


# Distribuião da metrite segundo a presença de doença cística do ovário


```{r, echo = F, out.width='70%', results='markdown'}

CrossTable(banco$ovar, banco$metritis, digits=2, prop.r=FALSE, 
           prop.c=TRUE, prop.t=FALSE, prop.chisq=FALSE, 
           chisq = FALSE, fisher=FALSE, mcnemar=FALSE)

```

````{r, echo = T, eval =F, out.width='70%', results='markdown'}
# Stacked Bar Plot 

tabela <- table(banco$ovar, banco$metritis)

barplot(prop.table(tabela), main="Metrite segundo a presença de doença cística do ovário",
  xlab="Presença de folículos ovarianos císticos", col=c("blue", "red"),
  legend = rownames(tabela), args.legend = list(x = 'topleft'))

```

# Distribuião da metrite segundo a retenção das membranas fetais


```{r, echo = F, out.width='70%', results='markdown'}

CrossTable(banco$retpla, banco$metritis, digits=2, prop.r=FALSE, 
           prop.c=TRUE, prop.t=FALSE, prop.chisq=FALSE, 
           chisq = FALSE, fisher=FALSE, mcnemar=FALSE)

```

````{r, echo = T, eval =F, out.width='70%', results='markdown'}
# Stacked Bar Plot 

tabela <- table(banco$retpla, banco$metritis)

barplot(prop.table(tabela), main="Metrite segundo a retenção das membranas fetais",
  xlab="Presença de folículos ovarianos císticos", col=c("blue", "red"),
  legend = rownames(tabela), args.legend = list(x = 'topleft'))

```

---

# Distribuição da metrite segundo a idade como variável quatitativa

```{r, echo = T, out.width='90%', results='markdown'}
by(banco$age, banco$metritis,summary)

```

```{r, echo = T, out.width='90%', results='markdown'}
boxplot(age ~ metritis, banco, ylab="Idade", xlab = "metritis")

```

---

# Distribuição da metrite segundo a qunatidade de dias dias desde o parto até a concepção (gravidez) 

```{r, echo = T, out.width='90%', results='markdown'}
by(banco$calvcon, banco$metritis,summary)

```

```{r, echo = T, out.width='90%', results='markdown'}
boxplot(calvcon ~ metritis, banco, ylab="Dias desde o parto até a concepção", xlab = "Metrite")

```

---

# Análise univariada utilizando o pacote *tableone*

## Exemplo de uma Tabela 1 - univariada


```{r, echo = T, out.width='70%', results='markdown'}

library(tableone)

# Selecionando as variaveis que irao compor a tabela

myVars <- c("metritis", "calvcon", "age", "faixa_eta", "culled", "ovar", "retpla")

## criando o obejeto da TableOne 

tabela1 <- CreateTableOne(vars = myVars, data = banco)

print(tabela1, showAllLevels = TRUE)
```

[*Introduction to tableone*](https://cran.r-project.org/web/packages/tableone/vignettes/introduction.html)



---

# Análise bivariada utilizando o pacote *tableone* 

## Exemplo de uma Tabela 1 - Bivariada


## Pacote *tableone* - Utilizando a variável metrite como desfecho  


```{r, echo = T, out.width='70%', results='markdown'}

myVars2 <- c("calvcon", "age", "faixa_eta", "culled", "ovar", "retpla")

tabela2 <- CreateTableOne(vars = myVars2, strata = "metritis", 
                                              data = banco)
print(tabela2, showAllLevels = TRUE)
```

